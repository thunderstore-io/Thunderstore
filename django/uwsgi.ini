[uwsgi]
# Django WSGI application
module = thunderstore.core.wsgi:application
wsgi-file = thunderstore/core/wsgi.py

# Master process
master = true
enable-threads = true

# Process Management
workers = 2                 # Set workers to number of CPU cores
threads = 4                 # Enable multi-threading
thunder-lock = true         # Better lock management for multi-worker
max-requests = 5000         # Restart workers after N requests to prevent memory leaks
max-worker-lifetime = 3600  # Restart workers after 1 hour
reload-on-rss = 2048        # Reload if using more than 2GB RAM
worker-reload-mercy = 60    # Wait 60 seconds before forcefully killing workers
need-app = true             # Exit if app not loaded

# Asynchronous configuration
# async = 1000
# gevent = 1000
# gevent-monkey-patch = true TODO: Is this needed?

# Network configuration
http-socket = 0.0.0.0:8000
socket-timeout = 60

# Request handling
max-requests = 5000

# Process management
vacuum = true
die-on-term = true
single-interpreter = true

# Logging
disable-logging = false
log-4xx = true              # Log 4xx errors
log-5xx = true              # Log 5xx errors
log-slow = true             # Log slow requests
log-slow-time = 3000        # Log requests taking more than 3 seconds

# Reload configuration (for development)
py-autoreload = %(UWSGI_AUTORELOAD)

# Stats Configuration
stats = :9191               # Expose stats on port 9191
stats-http = true           # Enable HTTP-based stats server
memory-report = true        # Enable memory reporting

# Buffer size optimizations
post-buffering = 8192
buffer-size = 65536
harakiri = 60               # Kill requests that take more than 60 seconds
harakiri-verbose = true

# Security
chmod-socket = 666
#uid = 1000
#gid = 1000
# PermissionError: [Errno 13] Permission denied: '/etc/ssl/private/db-certs/'